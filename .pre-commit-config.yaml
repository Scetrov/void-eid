# =============================================================================
# Void eID Pre-commit Configuration
# =============================================================================
# Install: pre-commit install
# Run manually: pre-commit run --all-files
# =============================================================================

repos:
  # ===========================================================================
  # General Checks
  # ===========================================================================
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      - id: trailing-whitespace
        exclude: ^(src/sui/bun\.lock|.*\.lock)$
      - id: end-of-file-fixer
        exclude: ^(src/sui/bun\.lock|.*\.lock)$
      - id: check-yaml
        args: ["--unsafe"]
      - id: check-json
        exclude: ^(package-lock\.json|src/sui/package-lock\.json|.*tsconfig.*\.json|\.vscode/.*\.json|\.devcontainer/.*\.json)$
      - id: check-added-large-files
        args: ["--maxkb=1000"]
      - id: check-merge-conflict
      - id: detect-private-key

  # ===========================================================================
  # Secret Scanning (gitleaks - industry standard, widely used)
  # ===========================================================================
  - repo: https://github.com/gitleaks/gitleaks
    rev: v8.18.4
    hooks:
      - id: gitleaks

  # ===========================================================================
  # Rust Backend
  # ===========================================================================
  - repo: local
    hooks:
      # Rust Format Check
      - id: rust-fmt
        name: Rust Format (cargo fmt)
        entry: bash -c 'cd src/rust && cargo fmt --check'
        language: system
        files: \.rs$
        pass_filenames: false

      # Rust Linting
      - id: rust-clippy
        name: Rust Lint (cargo clippy)
        entry: bash -c 'cd src/rust && cargo clippy --all-targets --all-features -- -D warnings'
        language: system
        files: \.rs$
        pass_filenames: false

      # Rust Build Check
      - id: rust-build
        name: Rust Build (cargo build)
        entry: bash -c 'cd src/rust && cargo build'
        language: system
        files: \.rs$
        pass_filenames: false

      # Rust Unit Tests
      - id: rust-test
        name: Rust Tests (cargo test)
        entry: bash -c 'cd src/rust && cargo test'
        language: system
        files: \.rs$
        pass_filenames: false

  # ===========================================================================
  # Frontend (TypeScript/React)
  # ===========================================================================
  - repo: local
    hooks:
      # TypeScript Type Check
      - id: frontend-typecheck
        name: Frontend TypeScript Check
        entry: bash -c 'cd src/sui && npm run build -- --noEmit 2>/dev/null || (npm run build 2>&1 | head -50)'
        language: system
        files: \.(ts|tsx)$
        pass_filenames: false

      # Frontend Lint (ESLint)
      - id: frontend-lint
        name: Frontend Lint (ESLint)
        entry: bash -c 'cd src/sui && npm run lint'
        language: system
        files: \.(ts|tsx|js|jsx)$
        pass_filenames: false

      # Frontend Build
      - id: frontend-build
        name: Frontend Build
        entry: bash -c 'cd src/sui && npm run build'
        language: system
        files: \.(ts|tsx|js|jsx|css|html)$
        pass_filenames: false

  # ===========================================================================
  # Playwright E2E Tests (optional - can be slow, run on push instead)
  # ===========================================================================
  # Uncomment below to run E2E tests on every commit (may be slow)
  # - repo: local
  #   hooks:
  #     - id: playwright-tests
  #       name: Playwright E2E Tests
  #       entry: bash -c 'cd src/sui && npx playwright test'
  #       language: system
  #       files: \.(ts|tsx)$
  #       pass_filenames: false
  #       stages: [push]  # Only run on push, not on every commit

# =============================================================================
# Configuration
# =============================================================================
default_stages: [pre-commit]
fail_fast: false
